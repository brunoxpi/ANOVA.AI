<div class="p-8">
  <!-- Header -->
  <div class="flex justify-between items-start mb-6">
    <div>
      <h2 class="text-3xl font-bold text-foreground">Visão Geral de Clientes</h2>
      <p class="text-label mt-1">Gerencie o onboarding e contratos dos seus clientes</p>
    </div>
    <div class="flex items-center space-x-3">
       <div class="group relative inline-block">
        <button class="px-4 py-2 bg-secondary-light border border-secondary text-foreground text-sm font-medium rounded-md hover:bg-secondary transition-colors flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
          Consultar Carteira
        </button>
        <span class="absolute -top-10 left-1/2 -translate-x-1/2 w-max px-2 py-1 bg-foreground text-background text-xs rounded-md opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
          Visualizar carteira de investimentos
        </span>
      </div>
       <div class="flex items-center gap-2">
        <div class="group relative inline-block">
          <button (click)="openDefineRatesModal()" class="px-4 py-2 bg-accent text-white text-sm font-medium rounded-md hover:brightness-95 active:brightness-90 transition-all flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>
            Novo Cliente
          </button>
          <span class="absolute -top-10 left-1/2 -translate-x-1/2 w-max px-2 py-1 bg-foreground text-background text-xs rounded-md opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
            Adicionar um novo cliente
          </span>
        </div>
         <app-onboarding-tip tipText="Clique aqui para iniciar o cadastro de um novo cliente. Você poderá definir as taxas de administração e performance antes de prosseguir."></app-onboarding-tip>
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    @for (stat of stats(); track stat.title) {
      <div class="bg-secondary-light p-5 rounded-lg border border-secondary">
        <p class="text-label text-sm">{{ stat.title }}</p>
        <p class="text-3xl font-bold text-foreground mt-1">{{ stat.value }}</p>
      </div>
    }
  </div>

  <!-- Client Table Section -->
  <div class="bg-secondary-light p-6 rounded-lg border border-secondary">
    <!-- Search and Filters -->
    <div class="flex justify-between items-center mb-5">
      <div class="relative w-full max-w-sm">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-label" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
        </div>
        <input 
          type="text" 
          placeholder="Buscar por ID, parceiro, Nome, Assessor ou Data de reg."
          class="w-full pl-10 pr-4 py-2 bg-secondary-light border border-secondary rounded-md text-sm focus:ring-accent focus:border-accent placeholder:text-label"
          (input)="updateSearch($event)">
      </div>
      <div class="flex items-center space-x-3">
        <button class="px-4 py-2 bg-secondary-light border border-secondary text-label text-sm font-medium rounded-md hover:bg-secondary transition-colors">Filtrar por Assessor</button>
        <button class="px-4 py-2 bg-secondary-light border border-secondary text-label text-sm font-medium rounded-md hover:bg-secondary transition-colors">Filtrar por Data</button>
      </div>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
      <table class="w-full text-left text-sm">
        <thead class="border-b border-secondary">
          <tr class="text-xs text-label uppercase">
            <th class="py-3 px-4 font-medium">Conta</th>
            <th class="py-3 px-4 font-medium">Nome</th>
            <th class="py-3 px-4 font-medium">Assessor</th>
            <th class="py-3 px-4 font-medium">Status do Onboarding</th>
            <th class="py-3 px-4 font-medium">Data de Registro</th>
            <th class="py-3 px-4 font-medium text-right">Ações</th>
          </tr>
        </thead>
        <tbody>
          @if (isLoading()) {
            @for (_ of [1,2,3,4,5]; track $index) {
              <tr class="border-b border-secondary animate-pulse">
                <!-- Conta -->
                <td class="py-4 px-4">
                  <div class="h-4 bg-secondary rounded w-20"></div>
                </td>
                <!-- Nome -->
                <td class="py-4 px-4">
                  <div class="h-4 bg-secondary rounded w-40"></div>
                </td>
                <!-- Assessor -->
                <td class="py-4 px-4">
                  <div class="h-4 bg-secondary rounded w-32"></div>
                </td>
                <!-- Status do Onboarding -->
                <td class="py-4 px-4">
                  <div class="flex items-center gap-2">
                    <div class="h-2 w-2 bg-secondary rounded-full shrink-0"></div>
                    <div class="h-4 bg-secondary rounded w-24"></div>
                    <div class="w-16 bg-secondary rounded-full h-1.5 ml-2"></div>
                    <div class="h-3 bg-secondary rounded w-8 ml-1"></div>
                  </div>
                </td>
                <!-- Data de Registro -->
                <td class="py-4 px-4">
                  <div class="h-4 bg-secondary rounded w-24"></div>
                </td>
                <!-- Ações -->
                <td class="py-4 px-4">
                  <div class="flex justify-end">
                    <div class="h-6 w-6 bg-secondary rounded-full"></div>
                  </div>
                </td>
              </tr>
            }
          } @else {
            @if (paginatedClients().length === 0) {
              <tr>
                <td colspan="6" class="text-center py-16">
                  <div class="flex flex-col items-center text-label">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mb-2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    <h3 class="text-lg font-medium text-foreground">Nenhum cliente encontrado</h3>
                    <p>Tente ajustar seus termos de busca ou filtros.</p>
                  </div>
                </td>
              </tr>
            } @else {
              @for (client of paginatedClients(); track client.account) {
                <tr class="border-b border-secondary hover:bg-background transition-colors">
                  <td class="py-4 px-4 text-label">{{ client.account }}</td>
                  <td class="py-4 px-4 font-medium text-foreground">{{ client.name }}</td>
                  <td class="py-4 px-4 text-label">{{ client.assessor }}</td>
                  <td class="py-4 px-4">
                    <button (click)="selectClient(client)" class="flex items-center w-full text-left rounded focus:outline-none focus:ring-2 focus:ring-accent focus:ring-offset-2 p-1 -m-1">
                      @if (client.status === 'Concluído') {
                        <span class="h-2 w-2 rounded-full bg-status-success mr-2 shrink-0"></span>
                        <span class="text-foreground">Concluído</span>
                      } @else {
                        <span class="h-2 w-2 rounded-full bg-status-warning mr-2 shrink-0"></span>
                        <div class="flex items-center gap-2 flex-grow">
                           <span class="text-foreground">Em Andamento</span>
                           @if (client.progress && client.totalSteps) {
                             <div class="w-16 bg-secondary rounded-full h-1.5">
                               <div class="bg-status-warning h-1.5 rounded-full" [style.width.%]="getOnboardingProgress(client)"></div>
                             </div>
                             <span class="text-xs text-label">{{ client.progress }}/{{ client.totalSteps }}</span>
                           }
                        </div>
                      }
                    </button>
                  </td>
                  <td class="py-4 px-4 text-label">{{ client.registrationDate }}</td>
                  <td class="py-4 px-4 text-right">
                    <div class="group relative inline-block">
                      <button class="text-label hover:text-foreground p-1 rounded-full hover:bg-secondary transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>
                      </button>
                       <span class="absolute -top-10 right-0 w-max px-2 py-1 bg-foreground text-background text-xs rounded-md opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                        Mais opções
                      </span>
                    </div>
                  </td>
                </tr>
              }
            }
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="flex justify-end items-center mt-5">
      <div class="flex items-center space-x-4 text-sm">
        <button 
          (click)="prevPage()" 
          [disabled]="currentPage() === 1"
          class="px-3 py-1 border border-secondary rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-secondary transition-colors">
          Anterior
        </button>
        <span class="text-label">Página {{ currentPage() }} de {{ totalPages() }}</span>
        <button 
          (click)="nextPage()" 
          [disabled]="currentPage() === totalPages()"
          class="px-3 py-1 border border-secondary rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-secondary transition-colors">
          Próximo
        </button>
      </div>
    </div>
  </div>
</div>

@if (selectedClient()) {
  <app-onboarding-modal 
    [client]="selectedClient()!" 
    (close)="closeModal()"
    (clientUpdate)="handleClientUpdate($event)">
  </app-onboarding-modal>
}

@if (isDefineRatesModalOpen()) {
  <app-define-rates-modal 
    (close)="closeDefineRatesModal()" 
    (save)="handleRatesDefined($event)">
  </app-define-rates-modal>
}
